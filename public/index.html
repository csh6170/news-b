<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsBrief Pro: ì •ë°€ ë‰´ìŠ¤ ìš”ì•½</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary-color: #00C2FF;
            --bg-color: #F4F7F9;
            --card-bg: #FFFFFF;
            --text-dark: #1A2B3C;
            --text-gray: #5E6E80;
            --border-radius: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            text-align: center;
            padding-top: 40px;
        }

        h1 { font-weight: 700; font-size: 2.5rem; margin-bottom: 30px; color: var(--text-dark); }
        h1 span { color: var(--primary-color); }
        
        .input-section { max-width: 700px; margin: 0 auto 50px auto; }

        .search-input-box {
            display: flex;
            align-items: center;
            background: #fff;
            border: 2px solid var(--primary-color);
            border-radius: 33px;
            padding: 2px 10px 2px 20px;
            box-shadow: 0 4px 12px rgba(0, 194, 255, 0.1);
        }

        .form-control {
            flex: 1;
            border: none !important;
            background: transparent;
            padding: 15px 0;
            font-size: 17px;
            outline: none;
            color: var(--text-dark);
        }

        .btn-search { background: none; border: none; cursor: pointer; padding: 10px; }
        .btn-search svg { width: 28px; height: 28px; fill: var(--primary-color); }

        .results-grid { display: none; text-align: left; margin-top: 30px; max-width: 1000px; margin-left: auto; margin-right: auto; }

        .card {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            border: 1px solid #E1E8ED;
        }

        .card h2 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-dark);
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .result-content { white-space: pre-wrap; line-height: 1.8; color: var(--text-dark); font-size: 1.05rem; word-break: break-all; }

        .highlight-title {
            display: block;
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 15px;
            line-height: 1.4;
            border-left: 4px solid var(--primary-color);
            padding-left: 10px;
        }

        @media (max-width: 900px) { h1 { font-size: 2rem; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>NewsBrief <span>Pro</span></h1>
        
        <div class="input-section">
            <div class="search-input-box">
                <span style="margin-right:12px;">ğŸ”</span>
                <input type="text" id="urlInput" class="form-control" placeholder="ìš”ì•½í•  ë‰´ìŠ¤ ê¸°ì‚¬ URLì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off">
                <button type="button" class="btn-search" id="searchBtn" onclick="startSummary()">
                    <svg viewBox="0 0 50 50"><path d="M22.13.5c11.378 0 20.632 9.256 20.632 20.63 0 4.699-1.566 9.155-4.439 12.782l10.164 10.165a2.41 2.41 0 0 1-1.706 4.115 2.412 2.412 0 0 1-1.706-.705L33.31 35.719a2.41 2.41 0 0 1 0-3.41 15.71 15.71 0 0 0 4.628-11.178c0-8.718-7.09-15.808-15.807-15.808-8.718 0-15.808 7.09-15.808 15.808 0 7.15 4.817 13.43 11.714 15.273a2.41 2.41 0 0 1 1.705 2.954 2.41 2.41 0 0 1-2.95 1.705C7.788 38.658 1.5 30.46 1.5 21.131 1.5 9.756 10.756.5 22.13.5zm4.716 34.746a3.483 3.483 0 1 1 0 6.966 3.483 3.483 0 0 1 0-6.966z"></path></svg>
                </button>
            </div>
        </div>

        <div id="resultArea" class="results-grid">
            <div class="card main-summary">
                <h2>ğŸ“‹ ê²°ê³¼</h2>
                <div id="summaryMain" class="result-content"></div>
                <div id="urlLinkArea"></div>
                <div id="disclaimerArea"></div>
            </div>
        </div>
    </div>

    <script>
        async function startSummary() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            if(!url) return alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
            
            const btn = document.getElementById('searchBtn');
            urlInput.value = '';
            document.getElementById('resultArea').style.display = 'none';
            btn.disabled = true;

            // [ì¶”ê°€] ì´ˆê¸° íŒì—… ë„ìš°ê¸°
            Swal.fire({
                title: 'AI ë¶„ì„ ì—ì´ì „íŠ¸',
                html: '<strong>ê¸°ì‚¬ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤...</strong>',
                icon: 'info',
                allowOutsideClick: false,
                showConfirmButton: false,
                position: 'center',
                didOpen: () => { Swal.showLoading(); }
            });

            try {
                const response = await fetch(`/summary?url=${encodeURIComponent(url)}`);
                if (!response.ok) throw new Error('ì—°ê²° ì‹¤íŒ¨');

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let accumulatedData = '';
                let isSummaryStarted = false; 

                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value, { stream: true });

                    // í•œ chunk ì•ˆì— ì—¬ëŸ¬ ê°œì˜ ë¡œê·¸ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì¤„ ë‹¨ìœ„ë¡œ ìª¼ê°œì„œ ì²˜ë¦¬
                    if (chunk.includes('[Debug]')) {
                        const lines = chunk.split('\n');
                        for (const line of lines) {
                            if (line.includes('[Debug]')) {
                                const debugMsg = line.split('[Debug]')[1].trim();
                                if (debugMsg) {
                                    Swal.update({ html: `<strong>${debugMsg}</strong>` });
                                }
                            }
                        }
                        // ë¡œê·¸ê°€ í¬í•¨ëœ chunkê°€ ìš”ì•½ ì‹œì‘ ì‹ í˜¸ë¥¼ í¬í•¨í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ continue
                        if (!chunk.includes("ìµœì¢… ì •ë°€ ìš”ì•½")) continue;
                    }

                    // ìˆœìˆ˜ ìš”ì•½ ë°ì´í„°ë§Œ ëˆ„ì  (ë¡œê·¸ ì˜¤ì—¼ ë°©ì§€)
                    accumulatedData += chunk;

                    const SEP_SUMMARY = "ìµœì¢… ì •ë°€ ìš”ì•½ (99.9% Accuracy)";
                    if (accumulatedData.includes(SEP_SUMMARY)) {
                        // ìš”ì•½ ë°ì´í„°ê°€ ê°ì§€ë˜ë©´ íŒì—… ë‹«ê³  ê²°ê³¼ì°½ ë…¸ì¶œ
                        if (Swal.isVisible()) { Swal.close(); }
                        document.getElementById('resultArea').style.display = 'block'; 
                        
                        let parts = accumulatedData.split(SEP_SUMMARY);
                        if (parts.length > 1) {
                            let mainText = parts[1].split("ë‚´ë¶€ ê°ì‚¬ ë¡œê·¸")[0];

                            // 1. ë¶ˆí•„ìš”í•œ êµ¬ë¶„ì„  ë° ì•ë’¤ ê³µë°± ì œê±°
                            mainText = mainText.replace(/[=]{5,}/g, '').trim();

                            // 2. [í•µì‹¬ ìˆ˜ì •] ì œëª© ìŠ¤íƒ€ì¼ ì ìš© ë¡œì§ ê°•í™”
                            // ì•ë’¤ì— ê³µë°±ì´ë‚˜ ì¤„ë°”ê¿ˆì´ ìˆì–´ë„ 'ğŸ“Œ ì œëª©:'ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë¼ì¸ì„ ì°¾ì•„ ê°ìŒ‰ë‹ˆë‹¤.
                            if (mainText.includes("ğŸ“Œ ì œëª©:")) {
                                mainText = mainText.replace(/ğŸ“Œ ì œëª©:\s*(.*?)(\n|$)/g, '<span class="highlight-title">ğŸ“Œ ì œëª©: $1</span><br>');
                            }

                            // 3. ë¬¸ì¥ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ ì ìš©
                            mainText = mainText.replace(/\.[\s]+/g, ".<br>");

                            document.getElementById('summaryMain').innerHTML = mainText;

                            if (!isSummaryStarted) {
                                isSummaryStarted = true;
                                // ì›ë¬¸ ë§í¬ ë° ë©´ì±… ì¡°í•­ ì£¼ì…
                                document.getElementById('urlLinkArea').innerHTML = `
                                    <div style="margin-top: 15px; padding-top: 10px; border-top: 1px dashed #E1E8ED;">
                                        <a href="${url}" target="_blank" style="color: var(--primary-color); font-weight: 700; text-decoration: none; font-size: 0.95rem;">
                                            ì›ë¬¸ ë³´ê¸° (í´ë¦­ ì‹œ ì´ë™) â†—
                                        </a>
                                    </div>`;
                                document.getElementById('disclaimerArea').innerHTML = `
                                    <p style="font-size: 0.85rem; color: #94a3b8; margin-top: 15px;">
                                        ğŸ’¡ ë³¸ ìš”ì•½ì€ AIê°€ ê¸°ì‚¬ ì›ë¬¸ì˜ íŒ©íŠ¸ë§Œì„ ì •ë¦¬í•œ ê²°ê³¼ì…ë‹ˆë‹¤.
                                    </p>`;
                            }
                        }
                    }
                }
            } catch (error) {
                Swal.fire('ì˜¤ë¥˜ ë°œìƒ', 'ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.', 'error');
            } finally {
                btn.disabled = false;
                urlInput.focus();
            }
        }

        document.getElementById('urlInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') startSummary();
        });
    </script>
</body>
</html>